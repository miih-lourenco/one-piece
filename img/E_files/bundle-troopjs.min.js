define("client-state/main",["when","poly/array"],function(a){function b(a){var b=this;return a in b&&b[a].apply(b,m.call(arguments,1))}function c(b,c){for(var d,e=t,k=b?b.split("."):[],l=k.pop();e&&(d=k.shift());)switch(g.call(e)){case h:case i:if(d in e){e=e[d];break}default:e=e[d]={}}return g.call(c)===j&&(c=c.call(v,u,b)),l!==f?a(c,function(a){return e[l]=a}):a(c)}function d(a){for(var b,c=t,d=a.split(".");c&&(b=d.shift());)switch(g.call(c)){case h:case i:if(b in c){c=c[b];break}default:c=f}return c}function e(a){for(var b,c=t,d=a.split("."),e=d.pop();c&&(b=d.shift());)switch(g.call(c)){case h:case i:if(b in c){c=c[b];break}default:c=f}return c!==f&&e in c}var f,g=Object.prototype.toString,h="[object Array]",i="[object Object]",j="[object Function]",k="[object String]",l=Array.prototype,m=l.slice,n=l.push,o="length",p="beforeGet",q="afterPut",r="init",s=[],t={},u={get:d,has:e},v={get:function(c,e,f,h){var i,j,l=this,n=m.call(arguments);for(i=0,j=n[o];j>i&&g.call(n[i])===k;i++);return e=n[i],f=n[i+1],h=n[i+2],n[o]=i,a.map(n,function(c){var e=s.filter(function(a){return a.isApplicable(c)});return a.map(e,function(d){return a(b.call(d,p,l,c))}).then(function(){return d(c)})}).then(e&&function(a){return e.apply(null,a)},f,h)},put:function(d,e,f,g,h){var i=this,j=s.filter(function(a){return a.isApplicable(d)});return a(c(d,e),function(c){return a.map(j,function(e){return a(b.call(e,q,i,d,c))})["yield"](c)}).then(f,g,h)},putIfNotHas:function(b,c,d,e,g){var h=this;return h.has(b)?a(f,d,e,g):h.put(b,c,d,e,g)},has:function(a){return e(a)},push:function(b,c){for(var d=this,e=m.call(arguments),g=[];(b=e.shift())!==f&&(c=e.shift())!==f;)g.push(d.put(b,c));return a.all(g)},flush:function(){t={}},addAdapters:function(){var b=this,c=m.call(arguments);return a.map(c,function(a){return g.call(a[r])===j?a[r](b):f}).then(function(){return n.apply(s,c)})},removeAdapters:function(a){var b=m.call(arguments);return s=s.filter(function(a){return!b.some(function(b){return a===b})}),s.length}};return v}),define("client-state",["client-state/main"],function(a){return a}),define("client-tracking/main",["client-state","when","poly/array"],function(a,b){var c,d=Array.prototype,e=d.slice,f=d.push,g=d.isArray,h=[],i={};return{push:function(){var c=this,d=h;return h=[],f.apply(d,arguments),b.map(d,function(d){return b(d.call(c,a))})},flush:function(a){a===c?i={}:delete i[a]},on:function(a,b){var c=i[a]||(i[a]=[]),d=e.call(arguments,1);f.apply(c,d)},off:function(a,b){var d=this,f=e.call(arguments,1);b===c?d.flush(a):i[a]=i[a].filter(function(a){return!f.some(function(b){return a===b})})},trigger:function(c){var d=this,e=[a];return f.apply(e,arguments),b.map(i[c]||[],function(a){return b(a.apply(d,e))})},pageload:function(d,e){var f=this,h=d?a.put("page.name",d):!0,i=e!==c?a.put("tracking.events",null==e||g(e)?e:[e]):!0;return b(h).then(i).ensure(function(){return f.trigger("pageload")})},useraction:function(a){var b=this;return b.trigger("useraction",a)},usercontext:function(c){var d=this;return b.map(Object.keys(c),function(b){return a.put("context."+b,c[b])}).then(function(){return d.trigger("usercontext")})},pagename:function(b){var c=this;return a.put("page.name",b).then(function(){return c.trigger("pagename")})}}}),define("client-tracking/adapters/etvt",[],function(){function a(a){return a?encodeURIComponent(a):""}return function(b){return b.get("user","session","page.environment","tracking.etvt_enabled").spread(function(b,c,d,e){if(e){var f;f="live"===d?"//etvt.englishtown.com/track/trackhandler.ashx":"stg"===d?"//stg-etvt.englishtown.com/track/trackhandler.ashx":"qa"===d?"//qa-etvt.englishtown.com/track/trackhandler.ashx":"//dev.englishtown.com/track/trackhandler.ashx",f=f+"?guid="+a(b.ef_id)+"&ctr="+a(b.market)+"&ptr="+a(c.partner_code)+"&request="+a(window.location.href)+"&referrer="+a(document.referrer)+"&vmsi="+a(c.vmsi)+"&etag="+a(c.etag);var g=document.createElement("img");g.src=f,document.getElementsByTagName("head")[0].appendChild(g)}})}}),define("client-tracking/adapters/omniture_v2",["when","poly/array","poly/object"],function(a){function b(b,c){return e||(e=a.promise(function(a,d){if(window.s&&window.s.t)a(window.s);else{var e=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(e),e.onload=e.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(e.onload=e.onreadystatechange=null,window.s?a(window.s):d(new Error("Omniture object not found")))},e.onerror=function(a){var b=new Error("omniture script load error");b.event=a,d(b)};var f=["mkt="+c.market],g="/_omniture/1.0/AppMeasurement.js";if(b.omniture_liburl&&"string"==typeof b.omniture_liburl){var h=b.omniture_liburl.split("?");g=h[0],h[1]&&h[1].split("&").forEach(function(a){a&&f.push(a)})}e.src=g+"?"+f.join("&")}})),e}function c(a,b,d){Object.keys(b).forEach(function(e){"object"==typeof b[e]?c(a,b[e],d?d+"."+e:e):a.contextData[d?d+"."+e:e]=b[e]})}function d(a){var b=/(com|co|net|org|gov|edu)\.[a-z]{2}\.?$/i,c=2,d=window.location.hostname;b.test(d)&&(c=3),"."===d.charAt(d.length-1)&&++c,a.fpCookieDomainPeriods=c.toString()}var e;return function(e,f,g){return e.get("user","session","page.name","tracking","context").spread(function(e,h,i,j,k){return j&&j.omniture_enabled?b(j,e).then(function(a){if(k&&c(a,k),g&&c(a,g),c(a,{"user.id":e.member_id,"user.language":e.language_code&&e.language_code.toUpperCase(),"user.partner":e.partner}),j.omniture_account&&(a.account=j.omniture_account),d(a),j.omniture_config&&"object"==typeof j.omniture_config){var b=j.omniture_config;Object.keys(b).forEach(function(c){a[c]=b[c]})}if(a.pageName=i,a.timestamp=Math.round((new Date).getTime()/1e3),"pageload"===f||"pagename"===f||"usercontext"===f){var h=a.t();h&&document.write(h)}else a.linkTrackVars=null,a.tl(!0,"o",f);a.contextData={}}):a.resolve()})}}),define("client-tracking/adapters/qubit",[],function(){return function(a){return a.get("tracking.qubit_enabled","page.environment").spread(function(a,b){if(a){var c=document.location.search.match(/qubit_debug/)||document.cookie.match(/(^| )qubit_debug/)?"//opentag.s3.amazonaws.com":"//d3c3cq33003psk.cloudfront.net";c+="live"===b?"/opentag-65468-362540.js":"stg"===b?"/opentag-65468-364364.js":"qa"===b?"/opentag-65468-364255.js":"/opentag-65468-364242.js";var d=document.createElement("script");d.src=c,d.async=!0,d.defer=!0,document.getElementsByTagName("head")[0].appendChild(d)}})}}),define("client-utils/base",[],function(){var a=".",b=RegExp("^(?:"+["ef","englishtown","englishfirst"].join("|")+")"),c=String.prototype.toString;return function(){for(var d,e=this,f=e.split(a),g=f.length;(d=f[--g])&&!b.test(d););return c.call(-1===g?e:f.slice(g).join(a))}}),define("client-utils/cookie",["./base","poly/object","poly/array","poly/json"],function(a){function b(a){return g[a]||a}function c(a,b){return e.call(b)===f?escape(b):b}function d(a,b){return e.call(b)===f?unescape(b):b}var e=Object.prototype.toString,f="[object String]",g={'"':"'",":":"=",",":"&"};return Object.keys(g).forEach(function(a){g[g[a]]=a}),{serialize:function(a){return JSON.stringify(a,c).replace(/[":,]/g,b).replace(/'(\w+)'=/g,"$1=").slice(1,-1)},deserialize:function(a){return JSON.parse("{"+a.replace(/(\w+)=/g,"'$1'=").replace(/['=&]/g,b)+"}",d)},options:function(a){var b=new Date;b.setFullYear(b.getFullYear()+1);var c=a.hostname,d=c.lastIndexOf("english");return-1==d&&(d=c.lastIndexOf("ef")),d>0?(d=c.lastIndexOf(".",d),c=c.substring(d+1)):c=null,{path:"/",domain:c,expires:b}},legacyOptions:function(a){var b=new Date;return b.setFullYear(b.getFullYear()+1),{path:"/",domain:a.hostname.match(/englishtown.com$/)?"englishtown.com":a.hostname,expires:b}}}}),define("client-state/adapters/et_s",["Cookies","client-utils/cookie"],function(a,b){var c="session",d="et_s";return{init:function(e){var f=a.get(d);return e.put(c,f?b.deserialize(f):{})},isApplicable:function(a){return a&&a.split(".")[0]===c},afterPut:function(e,f,g){var h=b.options(location);return delete h.expires,f===c?a.set(d,b.serialize(g),h):e.get(c,function(c){return a.set(d,b.serialize(c),h)})}}}),define("client-state/adapters/et_u",["Cookies","client-utils/cookie"],function(a,b){var c="user",d="et_u";return{init:function(e){var f=a.get(d);return e.put(c,f?b.deserialize(f):{})},isApplicable:function(a){return a&&a.split(".")[0]===c},afterPut:function(e,f,g){return f===c?a.set(d,b.serialize(g),b.options(location)):e.get(c,function(c){return a.set(d,b.serialize(c),b.options(location))})}}}),define("client-state/adapters/session",["Cookies","client-utils/cookie"],function(a,b){var c,d="session",e=d+".is_new_session",f=d+".is_returning",g=d+".vmsi",h=d+".etag",i=d+".partner_code",j="page",k=j+".is_new_session",l=j+".etag",m=j+".partner_code",n="VMsi",o="etag",p="ptn",q="et_uc",r=!a.get(q),s=function(c,d){var e=b.legacyOptions(location);return delete e.expires,a.set(c,d,e),d};return{isApplicable:function(a){return a&&a.split(".")[0]===d},beforeGet:function(j,o){var p,s=window.location;switch(o){case d:p=j.get(e,f,g,h,i);break;case e:p=j.get(k);break;case f:p=j.putIfNotHas(f,function(){return r&&a.set(q,1,b.options(s)),!r});break;case g:p=j.putIfNotHas(g,function(){return a.get(n)||Math.floor(32768*Math.random())+32768});break;case h:p=j.putIfNotHas(h,function(){return j.get(k,l,function(a,b){return a?b:c})});break;case i:p=j.putIfNotHas(i,function(){return j.get(k,m,function(a,b){return a&&b||"None"})})}return p},afterPut:function(a,b,c){switch(b){case g:c=s(n,c);break;case h:c=s(o,c);break;case i:c=s(p,c)}return c}}}),define("client-utils/uuid",[],function(){return function(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var b=[8,9,"a","b"];return a()+a()+"-"+a()+"-4"+a().substr(0,3)+"-"+b[Math.floor(4*Math.random())]+a().substr(0,3)+"-"+a()+a()+a()}}),define("client-utils/locale",[],function(){var a={ad:"es-ad",ae:"ar-ae",af:"en-af",ag:"en-ag",ai:"en-ai",ar:"es-ar",at:"de-at",aw:"es-aw",bb:"en-bb",be:"fr-be",bh:"ar-bh",bo:"es-bo",br:"pt-br",bz:"es-bz",ca:"fr-ca",ch:"de-ch",cl:"es-cl",cn:"zh-cn",co:"es-co",cr:"es-cr",cu:"es-cu",de:"de-de","do":"es-do",dz:"en-dz",ec:"es-ec",eg:"ar-eg",es:"es-es",fi:"sv-fi",fr:"fr-fr",gb:"en-gb",gt:"es-gt",hk:"zh-hk",hn:"es-hn",ht:"fr-ht",id:"id-id",il:"en-il",iq:"en-iq",ir:"en-ir",is:"is-is",it:"it-it",jm:"en-jm",jo:"ar-jo",jp:"ja-jp",kn:"en-kn",kr:"ko-kr",kw:"ar-kw",ky:"en-ky",kz:"en-kz",lb:"ar-lb",lc:"en-lc",li:"de-li",lu:"fr-lu",ly:"en-ly",ma:"en-ma",mc:"fr-mc",mo:"zh-mo",mx:"es-mx",ni:"es-ni",nl:"en-nl",om:"ar-om",pa:"es-pa",pe:"es-pe",pl:"en-pl",pr:"es-pr",py:"es-py",qa:"ar-qa",ru:"ru-ru",sa:"ar-sa",se:"sv-se",sg:"zh-sg",sv:"es-sv",sy:"ar-sy",th:"th-th",tj:"en-tj",tm:"en-tm",tn:"en-tn",tr:"tr-tr",tt:"en-tt",tw:"zh-tw",ua:"en-ua",us:"en-us",uy:"es-uy",uz:"en-uz",vc:"es-vc",ve:"es-ve",vg:"en-vg",vi:"en-vi",vn:"vi-vn",ye:"ar-ye"},b=["ar","en","es","fi","fr","it","ja","ko","pl","pt","ru","th","tr","vi"],c={"es-mx":"mx","es-es":"es","es-ad":"es","zh-hk":"hk","zh-tw":"ch"},d={de:"ge",es:"sp",id:"in",sv:"sw",zh:"cs"};return{mkt2clt:function(b){return a[b]||b},clt2lng:function(a){var e;return c[a]||d[e=a.substring(0,2)]||b.indexOf(e)>-1?e:"en"}}}),define("client-state/adapters/user",["Cookies","client-utils/cookie","client-utils/uuid","client-utils/locale"],function(a,b,c,d){var e,f="user",g=f+".ef_id",h=f+".culture_code",i=f+".language_code",j="EFID";return{isApplicable:function(a){return a&&a.split(".")[0]===f},beforeGet:function(b,e){var k;switch(e){case f:k=b.get(g,h,i);break;case g:k=b.putIfNotHas(g,function(){return a.get(j)||c()});break;case h:k=b.putIfNotHas(h,navigator.userLanguage||navigator.language);break;case i:k=b.putIfNotHas(i,function(){var a=location.search.match(/[?&]lng=([^&]+)/);return a?a[1]:b.get(h,function(a){return d.clt2lng(a)})})}return k},afterPut:function(c,d,f){switch(d){case g:var h=b.legacyOptions(location);a.set(j,f,h);var i=b.options(location);document.cookie.match("[ ;]"+d+"=.*?[ ;]"+d+"=")&&h.domain!=i.domain&&a.set(j,e,i)}return f}}}),define("client-state/adapters/page",["Cookies","client-utils/cookie"],function(a,b){var c,d="length",e="page",f=e+".domain",g=e+".path",h=e+".canonical_path",i=e+".environment",j=e+".etag",k=e+".partner_code",l=e+".name",m=e+".is_new_session",n="et_sc",o="etag",p="ptn",q=!a.get(n);return{isApplicable:function(a){return a&&a.split(".")[0]===e},beforeGet:function(r,s){var t,u=window.location;switch(s){case e:t=r.get(f,g,h,i,j,k,l);break;case f:t=r.putIfNotHas(f,u.hostname);break;case g:t=r.putIfNotHas(g,u.pathname);break;case h:t=r.putIfNotHas(h,u.pathname);break;case i:t=r.putIfNotHas(i,function(){var a=u.host;return a.match(/\d+\.\d+\.\d+\.\d+|localhost|dev|localnet|uat/)?"dev":a.match(/stg|staging/)?"stg":u.host.match(/qa/)?"qa":"live"});break;case j:t=r.putIfNotHas(j,function(){var b=u.href.match(/[?&]etag=([^&#]+)/);return b?b[1]:q?a.get(o):c});break;case k:t=r.putIfNotHas(k,function(){var b=u.href.match(/[?&]ptn=([^&#]+)/);return b?b[1]:q?a.get(p):c});break;case l:t=r.putIfNotHas(l,function(){for(var a=u.pathname.substring(1).replace(/\.[^.]*$/,"").replace(/\//g,":");":"===a.substring(a[d]-1);)a=a.substring(0,a[d]-1);return a});break;case m:t=r.putIfNotHas(m,function(){if(q){var c=b.options(u);delete c.expires,a.set(n,1,c)}return q})}return t}}}),define("client-utils/event",[],function(){function a(a,d){b[a]=d,c[d]=a}var b={},c={};return a("event2","MemberRegistration"),a("event4","LeadOnlineEnquiry"),a("event5","EmailEnglish"),a("event6","ReferAFriend"),a("event7","CommunityRegistration"),a("event8","EFLead"),a("event9","E1Lead"),a("event10","LeadTest"),a("event13","SelfStudyUse"),a("event14","StudyToolUse"),a("event15","VirtualClassroomLaunch"),a("event16","EmailEnglish11"),a("event17","ReturningFTP"),a("event18","PrivateTeaching"),a("event19","FreeContentLogin"),a("event20","FreeContentSignup"),a("event21","FreeContentBind"),a("event22","IPDetection"),a("event24","CustomActionCount"),a("event25","VideoTimeViewed"),a("event26","VideoView"),a("event27","VideoComplete"),a("event28","VideoSegmentView"),a("event29","VideoMilestone25"),a("event30","VideoMilestone50"),a("event31","VideoMilestone75"),a("event32","MemberRevenue"),a("event33","LeadOERevenue"),a("event34","EmailEnglishRevenue"),a("event42","FTORevenue"),a("purchase","OrderCreation"),a("event3","LeadTest"),{o2s:function(a){return b[a]||a},s2o:function(a){return c[a]||a}}}),define("client-state/adapters/tracking",["client-utils/event","poly/array"],function(a){var b=Array.prototype.push,c="tracking",d=c+".events";return{isApplicable:function(a){return a&&a.split(".")[0]===c},beforeGet:function(e,f){var g;switch(f){case c:g=e.get(d);break;case d:g=e.putIfNotHas(d,function(){var c=location.search.match(/[?&]omniEvents=([^&]+)/),d=location.search.match(/[?&]events=([^&]+)/),e=[];return c&&b.apply(e,c[1].split(",").map(function(b){return a.o2s(b)})),d&&b.apply(e,d[1].split(",")),e})}return g}}}),define("client-state/adapters/query",["when","troopjs-core/pubsub/hub","troopjs-utils/merge","module","poly/object"],function(a,b,c,d){function e(a){var b=[],c={countrycode:null,culturecode:null,partnercode:null,siteversion:null,studentcountrycode:null,languagecode:null},d=a.values;for(var e in d)e in c&&b.push(e+"="+d[e].value);return b.join("|")}function f(e,f){e="q="+e.join("|");var h=i[e];if(h===g){i[e]=h=a.defer();var k=c.call({},j,d.config(),{data:e});k.url=k.url+(f?"?"+f:""),b.publish("ajax",k,h)}return h.promise}var g,h=b.republish===g,i={},j={url:"/services/api/proxy/queryproxy",type:"post"};return function(a){return h?f(["context!current"]).spread(function(b){var c="c="+e(b);return f(a,c)}):b.publish("query",a)}}),define("client-state/adapters/context",["module","require","when","troopjs-core/pubsub/hub","./query","poly/object"],function(a,b,c,d,e){var f,g="context",h="trackingfield!",i=/[^.]*\.[^.]{2,3}(?:\.[^.]{2,3})?$/,j=["user.firstTimeStudyPlan","user.hasSetStudyPlan","user.daysSinceEnroll","user.velocity","user.hasStudyPlan"];return{init:function(b){var d=a.config(),e=document.location.hostname.match(i);return d&&d.data?(d.data["global.domain"]=e?e[0]:"null",c.map(Object.keys(d.data),function(a){return b.put(g+"."+a,d.data[a])})):void 0},isApplicable:function(a){return a&&a.split(".")[0]===g},beforeGet:function(a){return c.promise(function(b,d){var i=j.map(function(a){return h+"'"+a+"'"});e(i).spread(function(){return c.all(Array.prototype.slice.call(arguments).map(function(b){return b&&b.id?a.put(g+"."+b.id.replace(h,""),b.value!==f?b.value:"null"):void 0}))}).then(b,d)})}}}),define("client-state/bundle-troopjs",["./main","./adapters/et_s","./adapters/et_u","./adapters/session","./adapters/user","./adapters/page","./adapters/tracking","./adapters/context"],function(a,b,c,d,e,f,g,h){var i="et",j="state",k=Object.prototype.toString,l=window[i]||(window[i]={}),m=l[j]||[];return a.addAdapters(b,c,d,e,f,g,h).then(function(){l[j]=a,"[object Array]"===k.call(m)&&a.push.apply(a,m)}),a}),define("client-tracking/bundle-troopjs",["./main","./adapters/etvt","./adapters/omniture_v2","./adapters/qubit","client-state/bundle-troopjs"],function(a,b,c,d,e){var f="et",g="tracking",h=Object.prototype.toString,i=window[f]||(window[f]={}),j=i[g]||[];return i[g]=a,a.on("pageload",b,c,d),a.on("useraction",c),a.on("usercontext",c),a.on("pagename",c),"[object Array]"===h.call(j)&&a.push.apply(a,j),a}),define("client-tracking/version",[],function(){return"1.0.18+7748784"}),define(["client-tracking/bundle-troopjs"],function(a){return a});