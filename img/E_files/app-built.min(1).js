/**
 * µTemplate
 * @license MIT http://mikael.mit-license.org/ © Mikael Karon mailto:mikael@karon.se
 */

define("tooltips-ui/widget/tooltip/event-enum",{CLOSE:"tipclose"}),function(t){t("tooltips-ui/widget/uTemplate",[],function(){"use strict";var t="",e={'"':'\\"',"\n":"\\n","	":"\\t","\r":"\\r"};return function(o){function n(t,e,o){return p[d]=e?'" +'+o+'+ "':'";'+o+'o += "',"<%"+String(d++)+"%>"}function i(t,e){return p[e]}function r(t,o){return e[o]||o}var a=/^[\n\t\r]+|[\n\t\r]+$/g,s=/<%(=)?([\S\s]*?)%>/g,u=/<%(\d+)%>/gm,c=/(["\n\t\r])/gm,l=/o \+= "";| \+ ""/gm,p=[],d=0;return o=('var o = "'+o.replace(a,"").replace(s,n).replace(c,r).replace(u,i)+'"; return o;').replace(l,t),Function("data",o)}})}("function"==typeof define&&define.amd?define:function(t){module.exports=t()}),define("tooltips-ui/widget/popupbox/main",["troopjs-ef/component/widget","jquery","jquery.fancybox","../tooltip/event-enum","../uTemplate","jquery.mediaelement"],function(t,e,o,n,i,r){"use strict";function a(){var t=e("#fancybox-content div.tooltips-ui-tracking-container");t&&t.append('<iframe src="'+t.attr("data-trackurl")+'" width="1" height="1" frameborder="0" ></iframe>')}function s(){u&&!document.getElementById(u)&&(this.$element.append('<div id="'+u+'"></div>'),document.getElementById(u).SetReturnValue=function(){})}var u;return t.extend(function(t,n,c){if(!c)throw new Error("no parameter is provided for Popup");if(!c.tip)throw new Error("tip is must-have for Popup");var l=this,p=e.proxy(this.hide,this),d={tooltipId:c.TooltipId};d=e.extend(d,c.htmlData),c.tip=i(c.tip)(d),this.param={},e.extend(this.param,{padding:0,overlayOpacity:.4,overlayColor:"#000",transitionOut:"none",content:c.tip,autoScale:!1,hideOnOverlayClick:!0,onComplete:function(){var t=e("#fancybox-content");r(t[0]).find("video").mediaelementplayer({alwaysShowControls:!0,startVolume:.8,features:["playpause","current","progress","duration","tracks","volume"],success:function(t,e){u=t.id}}),t.delegate(".tooltips-ui-close","click",function(){o.fancybox.close()}),a()},onCleanup:function(){e("#fancybox-content").undelegate(".tooltips-ui-close","click"),p(),s.call(l)},onClosed:function(){s.call(l)}},c)},{"sig/start":function(t,e){o(this.$element).fancybox(this.param),e.resolve()},show:function(){var t=this;setTimeout(function(){t.$element.click()},1)},hide:function(){this.trigger(n.CLOSE,e("#fancybox-content .dismiss").prop("checked"))}})}),define("tooltips-ui/widget/tooltip/main",["troopjs-ef/component/widget","jquery-tipsy","./event-enum"],function(t,e,o){"use strict";function n(t){var e="try{return "+t+"}catch(e){}",o=new Function(e)();return o}var i="click";return t.extend(function(t,o,n){if(!n)throw new Error("no parameter is provided for Tooltip");if(!n.coordinator&&!n.coordinatorExpression)throw new Error("coordinator path/element or expression is must-have for Tooltip");this.param={},e.extend(this.param,{opacity:1,fade:!0,gravity:"n",offset:0,html:!0,trigger:"manual",shadow:!0},n),this.param.offset+=6},{_wrapperContent:function(t){return t='<div class="tipsy-content-wrapper">'+t+"</div>"},_isCoordinatorAlive:function(){var t;return this.param.coordinator?t=e(this.param.coordinator):(t=n(this.param.coordinatorExpression),t=e(t)),t=t.filter(":visible"),t.length?t:null},_attach:function(){var t=this,e=t._isCoordinatorAlive();return e&&(t.param.tip&&e.attr("title",t.param.tip),e.attr("title",t._wrapperContent(e.attr("title"))),e.tipsy(t.param)),e},show:function(){var t=this,o=t._attach();if(o){t.param.shadow&&t.showShadow(),o.tipsy("show");var n=e("body > div.tipsy");n.delegate(".tipsy-close",i,e.proxy(t.hide,t)),n[0].scrollIntoView(!1)}else window.console&&window.console.log("coordinator ["+t.param.coordinator+"] was not found or hidden"),t.hide()},hide:function(t){t&&t.preventDefault(),e("body > div.tipsy").undelegate(".tipsy-close",i).remove(),this.param.shadow&&this.hideShadow(),this.trigger(o.CLOSE)},showShadow:function(){var t=e(document.body),o=this;e('<div class="tipsy-shadow">').css({opacity:.4}).bind(i,function(t){o.publish("tooltip/die")}).appendTo(t)},hideShadow:function(){e("body > div.tipsy-shadow").remove()}})}),define("tooltips-ui/widget/tooltipFactory/main",["compose","troopjs-ef/component/widget","../tooltip/main","../popupbox/main"],function(t,e,o,n){"use strict";var i={Tooltip:[o,"tooltips/widget/tooltip/main"],TooltipPopup:[n,"tooltips/widget/popupbox/main"]};return t(function(t){if(!(t in i))throw new Error("specified ["+t+"]  widget is not defined");this.klass=i[t]},{create:function(){var t=[arguments[0],this.klass[1]].concat(Array.prototype.slice.call(arguments,2));return this.klass[0].apply(this,t)}})}),function(t,e){"use strict";var o=0,n=0,i=0,r={list:[],setup:function(){n=arguments.length;for(var t=0,e=n;e>t;t++)this.queue(arguments[t][0],arguments[t][1])},reset:function(){i=0,n=0,o=0,this.list.length=0},queue:function(t,e){if("number"==typeof e)o=Math.max(e,o);else if("function"==typeof e){for(var r=!1,a=0,s=this.list.length;s>a;a++)if(this.list[a].fn===t){this.list[a].fn=e,i++,r=!0;break}r||(t=e,e=++o,n++)}else e=++o;"function"!=typeof e&&this.list.push({fn:t,priority:e}),"function"==typeof t&&i++,this.list.sort(function(t,e){return t.priority-e.priority}),i===n&&0!==n&&this.dequeue()},dequeue:function(){var t=this,e=t.list[0];e&&"function"==typeof e.fn&&(t.list.shift(),e.fn.call(t,function(){t.dequeue()}))}};t.PopupQ||(t.PopupQ=r),"function"==typeof define&&define.amd&&define("tooltips-ui/widget/queue/main",[],function(){return t.PopupQ})}(window),define("tooltips-ui/widget/tooltip-manager/main",["troopjs-ef/component/widget","../tooltipFactory/main","jquery","json2","./../tooltip/event-enum","./../queue/main"],function(t,e,o,n,i,r){"use strict";function a(t){var e=o.Deferred();if(!t)return e.rejectWith(this,["no data was return. It might caused by fetching data with non-logging user."]),e;var i=t.Mappings,r=t.ExternalMappings,a=this,s={},u={},c=this.$element.data("attr");if(i){for(var l=0,d=i.length;d>l;l++){var f=n.parse(i[l].Tooltip.LayoutInfo||"{}");f.RouteId=i[l].RouteId,f.tip=i[l].Tooltip.Html,f.MappingId=i[l].MappingId,f.Type=i[l].Tooltip.Type,f.TooltipId=i[l].Tooltip.Id,f.htmlData=c;var h=f.RouteId?f.RouteId:p;s[h]||(s[h]=[]),s[h].push(f)}for(l=0,d=r.length;d>l;l++){var m=r[l],g=m.RouteId?m.RouteId:p;u[g]||(u[g]=[]),u[g].push(m)}this.token=t.Token}return e.resolveWith(a,[{data:s,externalData:u}]),e}function s(t,e){var o=[];e in t&&(o=t[e],delete t[e]);for(var n in t){var i=n.length;if(n.charCodeAt(0)===d&&n.charCodeAt(i-1)===d){var r=new RegExp(n.substring(1,i-1),"gi");r.test(e)&&(o=o.concat(t[n]),delete t[n])}}return f in t&&(o=o.concat(t[f]),e===p&&delete t[f]),o}function u(t){for(var n=this,i=0,r=t.length;r>i;i++){var a=e(t[i].Type),s=a.create(o("<div>"),"",t[i]);n.tooltips.push(s)}}function c(t){var e=this;(-1===e.current||e.current===this.tooltips.length-1)&&(e.publish("tooltips/finish",t||e.routeId),r.dequeue())}function l(t){var e="try{return "+t+"}catch(e){}",o=new Function(e)();return o}var p="#",d=47,f="*",h="debug=track=no",m={};return m["dom/"+i.CLOSE]=function(t,e,o){var n=this,i=n.currentTooltip().param.Type;"TooltipPopup"===i&&n.current!==n.tooltips.length-1&&n.track({dismiss:Boolean(o)});var r=this.next();r||(n.track({dismiss:Boolean(o)}),c.call(n),window.console&&window.console.log("Played all tooltips"))},t.extend(function(){this.externalData={},this.data=o.Deferred(),this.tooltips=[],this.current=-1,this.playMode="normal",this.index=-1},{"sig/start":function(t,e){var o=this;o.fetch().pipe(a).done(e.resolve).done(o.data.resolve).fail(e.reject).fail(function(t){window.console&&window.console.log(t)})},getData:function(t){var e=this;return o.Deferred(function(o){e.data.then(function(n){var i=s(n.data,t),r=s(n.externalData,t);i&&i.length>0?(o.resolveWith(e,[i,r]),window.console&&window.console.log("# of items: "+i.length+", "+r.length)):o.rejectWith(e,["no data for "+t+" was found"])},o.reject,o.notify)})},url:function(){var t=this.$element,e=t.data(),o=location.pathname+location.search;return e&&e.url&&(o=e.url),o=this.removeDebugFlag(o)},parseDebugFlag:function(t){var e=new RegExp("[?|&]"+h,"i");return e.test(t)?h.replace(/^([^=]*=)(.*)$/,function(){var t=arguments;return t[1]+encodeURIComponent(t[2])}):""},removeDebugFlag:function(t){var e=t.indexOf(h);if(e>-1){t=t.replace(h,"");var o=t.charAt(e-1);"?"===o||"&"===o?t=t.substr(0,e-1)+t.substr(e):";"===o&&(o=t.substring(e-5,5),"&amp;"===o&&(t=t.replace("&amp;","")))}return t},play:function(){this.publish("tooltips/start"),this.next()},next:function(){var t=this;if(t.tooltips.length>0){if("normal"===t.playMode){if(t.current===t.tooltips.length-1)return!1}else"loop"===t.playMode&&0!==t.current&&t.current%t.tooltips.length===0&&(t.current=0);var e=t.tooltips[++t.current];return t.append(e),t.wait(e).done(function(){t.show(e)}),!0}return c.call(t),window.console&&window.console.log("no tooltips found"),!1},append:function(t){return this.$element.append(t.start().$element),this},wait:function(t){var e=o.Deferred();return t.param.executewait?!function n(){var o=l(t.param.executewait);o?e.resolve(t):setTimeout(n,500)}():e.resolve(t),e.promise()},show:function(t){if(t.param.executebeforeshow)try{o.globalEval(t.param.executebeforeshow)}catch(e){}return t.show(),this},fetch:function(){var t="pageurl="+encodeURIComponent(this.url()),e=this.parseDebugFlag(location.search),n=this.$element.data("groups")?"groups="+encodeURIComponent(this.$element.data("groups")):"",i=[];return o.each([t,e,n],function(){this&&i.push(this)}),o.ajax({url:"/customerservice/tooltips/config/?"+[t,e,n].join("&"),dataType:"json",context:this})},track:function(t){var e=this.currentTooltip();o.post("/customerservice/tooltips/track/"+e.param.MappingId,o.extend({pageurl:this.url(),route:this.routeId,token:this.token.StringifiedToken,date:this.token.UtcTokenDate},t))},currentTooltip:function(){return this.tooltips[this.current]},reset:function(){var t=this;t.$element.empty(),t.tooltips.length=0,t.current=-1},"hub:memory/route":function(t,e){var o=this,n=e.source?"#"+e.source:p;o.routeId=n,o.getData(n).done(function(t){o.reset(),u.call(o,t),r.queue("tooltips",function(){o.play()})}).fail(function(){r.queue("tooltips",function(t){t()}),c.call(o,n),window.console&&window.console.log(arguments)})},"hub/tooltip/die":function(){var t=this.currentTooltip();this.current=this.tooltips.length-1,t.hide(),this.reset()}},m)}),define("tooltips-ui/widget/echo",["troopjs-ef/component/widget","jquery"],function(t,e){"use strict";var o,n="html",i="text",r="attr",a="selector",s="";return t.extend(function(t,e,n){n!==o&&(this[a]=n)},{echo:function(t){function o(e,o){return t[o]||s}var u=this,c=this.$element,l=c.data(),p={};a in u&&(t=t[u[a]]),e.each(l[r]||!1,function(e,o){t&&t[e]&&(p[e]=t[e])}),c.attr(p),n in l?c.html(l[n].replace(/\${(\w+)}/g,o)):i in l&&c.text(l[i].replace(/\${(\w+)}/g,o))}})});